<!-- Request Configuration -->
<div class="grow">
    <form
        class="flex h-full flex-col justify-between"
        [formGroup]="request.form"
        (ngSubmit)="onSubmit(request)"
    >
        <div>
            <h2 class="mb-2">Input reactant pair for C-N coupling</h2>
            <p class="leading-6">
                Please input one aryl halide / amine reactant pair to
                analyze for reaction condition predictions (catalyst, base,
                solvent).
            </p>

            <!-- Pathway Search -->
            <div class="mt-2 flex flex-col gap-6">
                <p-panel class="my-6">
                    <ng-template pTemplate="header">
                        <div
                            class="flex w-full items-center justify-between p-2 px-4"
                        >
                            <span class="text-lg">Reactant Pair</span>
                            <div class="flex gap-2">
                                <button
                                    type="button"
                                    class="flex items-center rounded-md border p-2"
                                    (click)="useExample()"
                                >
                                    <i class="pi pi-box mr-2"></i>
                                    Use an Example
                                </button>
                            </div>
                        </div>
                    </ng-template>
                    <ng-template pTemplate="content">
                        <div class="p-4">
                            <section>
                                <h3>Name your reactant pair</h3>
                                <input
                                    pInputText
                                    class="mt-2 w-full"
                                    placeholder="Enter reactant pair name..."
                                    formControlName="reactantPairName"
                                />
                            </section>
                            <section class="mt-2">
                                <h3>
                                    Enter your reactants<i
                                        class="pi pi-info-circle ml-2"
                                        pTooltip="Somn has been trained on reactants with only one reaction site; thus, it is encouraged to input reactants with one reaction site for analysis. If you enter a reactant with multiple reaction sites, you will be required to specify the intended reaction site."
                                    ></i>
                                </h3>
                                <div class="flex w-full gap-2">
                                    <div class="flex w-1/2 flex-col">
                                        <div
                                            class="mt-2 flex justify-between text-sm"
                                        >
                                            <span class="font-semibold"
                                                >Aryl Halide
                                                (bromide/chloride)</span
                                            >
                                            <span class="font-light"
                                                >Example:
                                                <span
                                                    class="font-normal underline"
                                                    >Bromobenzene</span
                                                >
                                            </span>
                                        </div>
                                        <input
                                            pInputText
                                            class="mt-2 w-full"
                                            placeholder="Enter aryl halide name..."
                                            formControlName="arylHalideName"
                                        />
                                        <app-marvinjs-input
                                            class="mt-2"
                                            placeholder="Enter aryl halide SMILES..."
                                            [smiles]="request.form.controls['arylHalideSmiles'].value || ''"
                                            (smilesChange)="request.form.controls['arylHalideSmiles'].setValue($event)"
                                        >
                                        </app-marvinjs-input>
                                        <ng-container
                                            *ngIf="request.form.controls['arylHalideSmiles'].value"
                                        >
                                            <ng-container
                                                *ngTemplateOutlet="moleculeDiagram; context: {
                                                    options: ['a', 'b'],
                                                    formControlName: 'arylHalideReactionSite',
                                                    diagram: 'https://fakeimg.pl/640x360',
                                                    isInfo: !request.form.controls['arylHalideReactionSite'].value
                                                }"
                                            ></ng-container>
                                        </ng-container>
                                    </div>
                                    <div class="flex w-1/2 flex-col">
                                        <div
                                            class="mt-2 flex justify-between text-sm"
                                        >
                                            <span class="font-semibold"
                                                >Amine</span
                                            >
                                            <span class="font-light"
                                                >Example:
                                                <span
                                                    class="font-normal underline"
                                                    >Bromobenzene</span
                                                >
                                            </span>
                                        </div>
                                        <input
                                            pInputText
                                            class="mt-2 w-full"
                                            placeholder="Enter amine name..."
                                            formControlName="amineName"
                                        />
                                        <app-marvinjs-input
                                            class="mt-2"
                                            placeholder="Enter amine SMILES..."
                                            [smiles]="request.form.controls['amineSmiles'].value || ''"
                                            (smilesChange)="request.form.controls['amineSmiles'].setValue($event)"
                                        >
                                        </app-marvinjs-input>
                                        <ng-container
                                            *ngIf="request.form.controls['amineSmiles'].value"
                                        >
                                            <ng-container
                                                *ngTemplateOutlet="moleculeDiagram; context: {
                                                    options: ['a', 'b'],
                                                    formControlName: 'amineReactionSite',
                                                    diagram: 'https://fakeimg.pl/640x360',
                                                    isInfo: !request.form.controls['amineReactionSite'].value
                                                }"
                                            ></ng-container>
                                        </ng-container>
                                    </div>
                                </div>
                            </section>
                        </div>
                    </ng-template>
                </p-panel>
            </div>
        </div>

        <!-- Subscription Email Input -->
        <div
            class="flex justify-between rounded-t-md bg-[#F3F5FB] px-10 pt-8"
        >
            <div class="flex flex-col">
                <div class="mb-2 flex items-end justify-center">
                    <span class="mb-1 pr-12">
                        <h2 class="m-0 mr-2 inline">Email</h2>
                        Leave an email to get an notification when your
                        results are ready.
                    </span>
                </div>
                <div class="w-full">
                    <input
                        id="subscriber-email"
                        type="email"
                        aria-describedby="subscriber-email-help"
                        [class]="'h-12 w-full'
                        + ((request.form.controls['subscriberEmail'].invalid
                            && request.form.controls['subscriberEmail'].dirty) ? ' ng-invalid ng-dirty' : '')"
                        pInputText
                        placeholder="Enter email here"
                        formControlName="subscriberEmail"
                    />
                    <small
                        *ngIf="request.form.controls['subscriberEmail'].invalid
                            && request.form.controls['subscriberEmail'].dirty"
                        id="subscriber-email-help"
                        class="p-error mt-2 block"
                        >Email is invalid.</small
                    >
                </div>
                <div class="py-4">
                    <p-checkbox
                        name="subscription"
                        styleClass="subscription-checkbox"
                        label="Agree to receive email notifications and updates about Novostoic."
                        [binary]="true"
                        [formControl]="request.form.controls['agreeToSubscription']"
                    ></p-checkbox>
                </div>
            </div>
            <p-button
                label="Analyze Using Somn"
                type="submit"
                styleClass="bg-[#224063]"
                [disabled]="request.form.invalid"
                iconPos="right"
                icon="pi pi-arrow-right"
            ></p-button>
        </div>

        <ng-template
            #moleculeDiagram
            let-options="options"
            let-diagram="diagram"
            let-formControlName="formControlName"
            let-isInfo="isInfo"
        >
            <div
                class="relative mt-4 grow flex-col items-center justify-center rounded-md border border-solid border-[--surface-d]"
            >
                <i class="pi pi-check-circle absolute left-3 top-3"></i>
                <div class="flex items-center justify-center">
                    <img class="h-[180px] w-auto" [src]="diagram" />
                </div>
                <!-- <div
                    class="m-2 flex flex-col gap-2 rounded-md p-2"
                    [class]="isInfo ? 'bg-[#e9e9ff]' : 'bg-[#E4F8F0]'"
                >
                    <div
                        class="flex items-center gap-2"
                        [class]="isInfo ? 'text-[#696CFF]' : 'text-[#1EA97C]'"
                    >
                        <i
                            class="pi"
                            [class]="isInfo ? 'pi-info-circle' : 'pi-check-circle'"
                        ></i>
                        <div>
                            More than one reaction site has been detected in
                            your input; please specify the intended site to
                            continue.
                        </div>
                    </div>
                    <p-dropdown
                        styleClass="w-full"
                        [options]="options"
                        [formControlName]="formControlName"
                        placeholder="Select Reaction Site"
                    ></p-dropdown>
                </div> -->
            </div>
        </ng-template>
    </form>
</div>